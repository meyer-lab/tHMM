
<!DOCTYPE html>

<html lang="Python3">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Demo and Instructions &#8212; tHMM 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="System Requirements" href="system-reqs.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="demo-and-instructions">
<h1>Demo and Instructions<a class="headerlink" href="#demo-and-instructions" title="Permalink to this headline">¶</a></h1>
<p>All functions for creating synthetic data, importing experimental data, and fitting are in the <cite>lineage</cite> folder. Benchmarking figure function that can be accessed through <cite>lineage/figures</cite> folder. The synthetic cellular observations were created under the name of state distributions in the <cite>lineage/states</cite> folder, and unit tests for almost all functions written in the package are in the <cite>lineage/tests</cite> folder.</p>
<p>To build the figures, for instance figure4, you can run the following in the terminal while in the main repository folder:</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">make</span> <span class="pre">output/figure4.svg</span>
<span class="pre">`</span></code></p>
<p>To run the unit tests:</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">make</span> <span class="pre">test</span>
<span class="pre">`</span></code></p>
<section id="creating-synthetic-data-and-fitting-the-model">
<h2>Creating synthetic data and fitting the model<a class="headerlink" href="#creating-synthetic-data-and-fitting-the-model" title="Permalink to this headline">¶</a></h2>
<p>The following shows how to create a 2-state synthetic lineage of cells with cell fate and cell lifetime observations, fit them to the model, and output the corresponding transition matrix, initial probability matrix, and the estimated parameters for the distribution of each state.</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a>`
import numpy as np
from lineage.states.StateDistributionGamma import StateDistribution
from lineage.LineageTree import LineageTree</p>
<p># pi: the initial probability vector
pi = np.array([0.6, 0.4], dtype=&quot;float&quot;)
# This means that the first cell in our lineage in generation 1
# has a 60% change of being state 0 and a 40% chance of being state 1.
# The values of this vector have to add up to 1 because of the
# Law of Total Probability.</p>
<p># T: transition probability matrix
T = np.array([[0.75, 0.25],</p>
<blockquote>
<div><p>[0.25, 0.75]], dtype=&quot;float&quot;)</p>
</div></blockquote>
<p># State 0 parameters &quot;Resistant&quot;
bern_p0 = 0.99 # a cell fate parameter (Bernoulli distribution)
gamma_a0 = 7 # the shape parameter of the gamma distribution, corresponding to the cell cycle duration
gamma_scale0 = 7 # the scale parameter of the gamma distribution, corresponding to the cell cycle duration</p>
<p># State 1 parameters &quot;Susceptible&quot;
bern_p1 = 0.88 # a cell fate parameter (Bernoulli distribution)
gamma_a1 = 7 # the shape parameter of the gamma distribution, corresponding to the cell cycle duration
gamma_scale1 = 1 # the scale parameter of the gamma distribution, corresponding to the cell cycle duration</p>
<p>state_obj0 = StateDistribution(bern_p0, gamma_a0, gamma_scale0)
state_obj1 = StateDistribution(bern_p1, gamma_a1, gamma_scale1)</p>
<p>E = [state_obj0, state_obj1]</p>
<p># creating the synthetic lineage of 15 cells, given the state distributions, transition probability, and the initial probability vector.
lineage = LineageTree.init_from_parameters(pi, T, E, desired_num_cells=2**9 - 1)
<a href="#id3"><span class="problematic" id="id4">``</span></a><a href="#id5"><span class="problematic" id="id6">`</span></a></p>
<p>Now that we have created the lineages as Python objects, we use the following function to fit this data into the model.</p>
<p><a href="#id7"><span class="problematic" id="id8">``</span></a>`
from lineage.Analyze import Analyze</p>
<p>X = [lineage] # population just contains one lineage
tHMMobj, pred_states_by_lineage, LL = Analyze(X, 2) # find two states</p>
<p># Estimating the initial probability vector
print(tHMMobj.estimate.pi)</p>
<p># Estimating the transition probability matrix
print(tHMMobj.estimate.T)</p>
<p># The total log likelihood
print(LL)</p>
<dl class="simple">
<dt>for state in range(lineage.num_states):</dt><dd><p>print(&quot;State {}:&quot;.format(state))
print(&quot;       estimated state:&quot;, tHMMobj.estimate.E[state].params)
print(&quot;original parameters given for state:&quot;, E[state].params)
print(&quot;n&quot;)</p>
</dd>
</dl>
<p><a href="#id9"><span class="problematic" id="id10">``</span></a><a href="#id11"><span class="problematic" id="id12">`</span></a></p>
</section>
<section id="importing-the-experimental-data-and-fitting-the-model">
<h2>Importing the experimental data and fitting the model<a class="headerlink" href="#importing-the-experimental-data-and-fitting-the-model" title="Permalink to this headline">¶</a></h2>
<p><a href="#id13"><span class="problematic" id="id14">``</span></a>`
import numpy as np
from lineage.LineageInputOutput import import_exp_data
from lineage.states.StateDistributionGaPhs import StateDistribution
from lineage.LineageTree import LineageTree
from lineage.Analyze import run_Analyze_over</p>
<p>desired_num_states = 2 # does not make a difference what number we choose for importing the data.
E = [StateDistribution() for _ in range(desired_num_states)]</p>
<p># Importing only one of the replicates of control condition
control1 = [LineageTree(list_of_cells, E) for list_of_cells in import_exp_data(path=r&quot;lineage/data/LineageData/AU00601_A5_1_V5.xlsx&quot;)]</p>
<p>output = run_Analyze_over([control1], 2, atonce=False)
<a href="#id15"><span class="problematic" id="id16">``</span></a>`
To find the most likely number of states, we can calculate the BIC metrc for 1,2,3,... number of states and find out the likelihoods.
The following calculates the BIC for 2 states, as we chose in the <cite>run_Analyze_over</cite> above.</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">BICs</span> <span class="pre">=</span> <span class="pre">np.array([oo[0].get_BIC(oo[2],</span> <span class="pre">75,</span> <span class="pre">atonce=True)[0]</span> <span class="pre">for</span> <span class="pre">oo</span> <span class="pre">in</span> <span class="pre">output])</span>
<span class="pre">`</span></code></p>
<p>The output of fitting could be the transition matrix:
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">np.array([oo[0].estimate.T</span> <span class="pre">for</span> <span class="pre">oo</span> <span class="pre">in</span> <span class="pre">output])</span>
<span class="pre">`</span></code></p>
<p>initial probability matrix:
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">np.array([oo[0].estimate.pi</span> <span class="pre">for</span> <span class="pre">oo</span> <span class="pre">in</span> <span class="pre">output])</span>
<span class="pre">`</span></code></p>
<p>the assigned cell states lineage by lineage:
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">np.array([oo[1]</span> <span class="pre">for</span> <span class="pre">oo</span> <span class="pre">in</span> <span class="pre">output])</span>
<span class="pre">`</span></code></p>
<p>the distribution parameters for each state:
<a href="#id17"><span class="problematic" id="id18">``</span></a>`
for state in range(2):</p>
<blockquote>
<div><p>print(&quot;State {}:&quot;.format(state))
print(&quot;       estimated state:&quot;, output[0][0].estimate.E[state].params)
print(&quot;n&quot;)</p>
</div></blockquote>
<p><a href="#id19"><span class="problematic" id="id20">``</span></a><a href="#id21"><span class="problematic" id="id22">`</span></a></p>
<p>Depending on the number of cells and lineages being used for fitting, the run time for <cite>Analyze</cite> and other similar functions that run the fitting, could takes minutes to hours.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">tHMM</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Installation.html">Installation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="system-reqs.html">System Requirements</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Demo and Instructions</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="system-reqs.html" title="previous chapter">System Requirements</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Farnaz Mohammadi, JC Lagarde, Aaron S Meyer.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.5.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/demo.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>