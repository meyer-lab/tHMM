## Introduction

<!-- motivation; heterogeneity is an obstacle for chemotherapy  -->
One of the primary treatments of cancer consists of chemotherapy, mainly targeted therapies, whereby patients are administered drugs that eliminate fast-proliferating cells to stall cancer growth or eliminate the tumor. Long-term therapeutic efficacy, however, varies significantly due to the vast heterogeneity in intratumor response to therapy [@pmid:16129367; @pmid:20619739]. Cell variability in drug response can originate from cell-intrinsic factors, such as genomic alterations (i.e., altered nucleotide excision repair, telomere maintenance, and copy-number variation) and epigenetic mechanisms like changes in a chromatin state [@pmid:20371346], or cell-extrinsic factors such as spatial variability in the surrounding vasculature and environmental stressors [@pmid:26972587; @pmid:25131830; @pmid:29250983].

<!-- literature review in conventional single-cell variability studies -->
Advances in ‘omics’ technologies have enabled detailed analysis of cell-to-cell variability [@pmid:20619739; @pmid:22397650], and the development of fine mapping and protein network algorithms have determined the presence of causal genetic mutations and dysregulation events that drive abnormal protein function [@pmid:25104515; @pmid:27322546]. These modalities, however, are labor and time-intensive, do not account for environmental factors, and serve primarily as end-point analysis barring longitudinal observation of tumor evolution. In addition to 'omics' modalities, genetic _association_ studies (i.e., Cancer Cell Line Encyclopedia) are similarly able to find common risk factors with smaller effect sizes using population-level samples. The findings are valuable but fail to identify rare and meaningful transitions on the single-cell level [@pmid:22460905], in particular the stochastic changes in individual cell states that have significant effects on overall tumor resistance. Lastly, fitness markers such as cell end-of-life fate, lifetime, and population doubling time are adopted in the clinical setting to measure cell pathologies [@pmid:12640450; @pmid:8072198; @pmid:8655369; @pmid:20981102]. Recent research has made efforts to track phenotypic measurements of fitness at the single-cell level [@pmid:29381859; @pmid:22886092]; however, most efforts are not yet resolved enough to illuminate the full complexity of cancer cells due in large part to reliance on population-level analysis (i.e., IC~50~) [@pmid:25421725].  

<!-- where conventional methods fail and introduction of thmm -->
These conventional methods cannot illuminate the scope of resistance inheritance by themselves, but instead can be combined with an additional means of tracking inheritance patterns through multiple generations of cells. The latter concept has been well-implemented in genetic studies of _linkage_ analyses, which use pairs of affected relatives (i.e., siblings, parents) to identify genes that are shared more frequently among those who exhibit a known phenotype [@pmid:19136655]. As a result, linkage analyses have found success in identifying rare risk factors that possess large effect sizes. Of note, linkage analyses are most potent when multiple routes to molecular change can each give rise to a frequent phenotypic change. In the cellular level, linkage analyses rely on lineage trees to identify groups of related cells within subpopulations, and in general, hidden Markov models (HMMs) let someone infer cell state from indirect measurements. By expanding the HMM framework to a lineage tree, we can form a tree Hidden Markov model (tHMM) to enable single-cell linkage analysis of cellular heterogeneity.

<!-- tHMM literature review -->
In general, tHMMs have been used for a multitude of purposes, from document image classification to understanding plant-tree architecture [@pmid:18255546; @doi:10.1109/TSP.2004.832006]. The earliest actualization and implementation of the tree modifications came from Crouse et al. who developed an upward-downward recursion expectation-maximization algorithm, different from the original forward-backward algorithm associated with HMMs, to determine wavelet coefficients in statistical signal processing [@doi:10.1109/78.668544; @doi:10.1109/TSP.2004.832006]. In biology, tree-based models utilizing linkage and inheritance information have  been employed in phylogeny discovery and evolutionary analyses [@pmid:23762278], and such models have been validated in molecular systems, such as identifying chromatin hidden states by observing histone modifications [@doi:10.1101/373258; @pmid:23734743]. Olariu et al. modeled stem cell lineages with hidden Markov trees to reconstruct the lineage tree based on the observations of the level of expression of a particular cell surface antigen [@pmid:19029621]. More recently, others have shown success in inferring the latent states of bacterial cells and the associated state-switching dynamics from lineage tree data [@doi:10.1101/488981].  

<!-- literature review of survivorship and time censoring -->
There are two difficulties associated with single-cell lineage data. In each lineage tree, edges are representative of the time duration that takes a particular cell to divide. The clades that contain cells that divide faster are more represented in the population and these overrepresented colonies introduce survivorship bias to the sample data. If this bias is disregarded, the model would fail to converge to the correct answer. In some studies the survivorship bias is addressed by adopting different strategies to sample from the lineage trees such as forward sampling, where starting from the root cell they track cells over generations by randomly selecting a daughter cell at each division, retrospective sampling which traverses the tree from a leaf cell to the root cell, and tree sampling where they removed leaf cells [@doi:10.1101/488981; @doi:10.3389/fphy.2018.00064]. Another difficulty is the time censorship. At the final time point of an experiment, cells that are still alive will die/divide at some point after the cut off time of the experiment and inevitably results in missing information about their lifetime and fate. On the other hand, there are cells that have been born at an unkonwn time before the beginning of the experiment. In thses two cases, due to the finite experiment duration the data is right- and left-censored, respectively. Time censoreship needs to be properly handled such that censored values are treated differently from uncensored values. In the process of fitting, we intend to find the most likely distribution source of the random values, i.e., measured phenotypes. To address the time censoreship issue, Johnson et al. have depeloved a non-parameteric Bayesian estimator for age-dependent branching processes [@doi:10.1016/0304-4149(79)90052-8]. Similarly, here we employed the survival distribution function specifically for censored samples in the data and fitted the original probability distributions to uncensored samples, which resulted in accurate and correct convergence of the model.  

<!-- significance -->
None of the aforementioned models, however, have been developed for cell phenotype analysis with potential application in tumor-specific cancer therapy, nor have any of these models been provided open source for the scientific community. Specifically, we presesnt a tHMM that expands phenotypic cell classification through the following functions: (1) learning to find the parameters for the tHMM given observations of lineage trees and a number of hidden states, (2) evaluating data by finding the probability that the model generates the lineage trees given some probabilistic parameters (i.e., likelihood), (3) decoding the data to find the most probable trees of hidden states given a population, (4) predicting by discovering the next observation or sequence of observations given an initial set of lineage trees. An example protocol for sequential phenotype measurements and tHMM extrapolation are shown in Figure 1. The tHMM pipeline in its current version is provided as an open source toolkit in Python (<https://github.com/meyer-lab/lineage-growth>). This computational tool is equipped with class modules and functions that can be easily edited to serve a user’s specific purpose and can be used immediately with ease. We also provide tools for lineage data preprocessing, lineage data input and output, and lineage data visualization, apart from the main methods involving tHMM analysis. We hope to enable other investigators to understand the identities of heterogeneous subpopulations in both basic research settings and clinical analysis.
