## Results

### Identifying heterogeneity in cell populations

[//]: # "Figure 1"

As a motivating example, we present two cases of cell population growth over time, one where the population is relatively homogeneous and all cells show consistent behaviour across their observed phenotypes, and one where the population can be clustered into at least two subpopulations, each with different growth rates. Over time, the two populations look similar, with regards to usual methods of analysis, such as TODO. These methods fail to capture the heterogeneity in the second population, and assumptions made from these results would be incomplete. However, utilizing the tHMM model we have built, we are not only able to capture the heterogeneity present in the two different populations, but also quantify the relative presence of these two states, and summarize the characteristics of the observed phenotypes.

![A tree hidden Markov model can disentangle single-cell states in a population, given only heritable observations.](./output/figure1.svg){#fig:1}

### tHMM can be trained on several observable phenotypes as emissions.

[//]: # "Figure 2"

Any observable heritable phenotype with a definable distribution could be used as an emission. The following (Figure 2) shows a schematic of a lineage tree in which we can observe phenotypes such as, cell fate, inter-mitotic times (lifetimes), G1 cell cycle phase duration, G2 cell cycle phase duration, and cell shape. For each of these features we consider a probabilistic distribution, shown in parts b-e.

![**This figure shows the flexibility of the model and that we can use any tracktable phenotype.](./output/figure2.svg){#fig:2}

### Model performs reasonable in the presence of different censoring types in the data.

In this part we compare model performance in case where we have a full binary tree, and where the data in censored due to cell death and experiment end time. The upper row shows the lineage tree over time for full tree and censored data, the lower row represents state assignement accuracy for both cases.

![**Censored versus uncensored data. Model performes well even if we have censored data.](./output/figure3.svg){#fig:3}

### tHMM performs accurately on experimentally-reasonable large lineages.

[//]: # "Figure 4"

Here we show the performance of the model by increasing the cell numbers. The figure shows the state assignment accuracy and parameter estimations for censored lineages.

![**A figure to show how many cells we would need to obtain a reasonable performance.](./output/figure4.svg){#fig:4}

### tHMM performs best when the difference between cell states is significant.

[//]: # "Figure 5"

Determining a threshold of some quality or characteristic to define "different states" in the context of cell biology is complicated. One can consider a continuous spectrum of a phenotype within a heterogeneous tumor of cells. For example, in a population one can consider infinite states corresponding to the proliferation speed. Moreover, with the assumption of discrete and finite number of states, it is hard to draw a line and separate fast from slow proliferating cells, especially if the difference is slight. To simplify this concept, we consider the cell states to be discrete and finite. In either case, if the phenotype that we are tracing as an emission is more distinct between the states, clustering cells with that phenotype and state assignment associated with cells is easier.  
In order to test the performance of our model given different cases as the states being similar or different, we employed Wasserstein distance metric. In our setup, the emissions include cell fate (in G1 and S/G2), G1 phase duration, and S/G2 phase duration in two states. To represent the difference between states associated with these phenotypes, we kept cell fate and S/G2 duration parameters constant and varied a G1 phase duration parameter across the states. We sweep a space where at the beginning the two states are very similar and they becomre more and more different. The shared parameters associated with the emission between the two states are ($bern_{G_1} = 0.99$, $bern_{G_2} = 0.8$, $shape_{G_1} = 12$, $shape_{G_2} = 10$, $scale_{G_2} = 5$) and the scale parameter of G1 phase for state 1 is being varied in the range of $[1, 2.5]$, while the scale parameter of G1 in state 2 is kept at $1$.  
Figure 4a depicts the similarity and difference between two states in terms of cell shapes. The upper row represents state 1 with a gradual change of states over four stages, while the lower row shows state 2 which is kept the same so that the two states become more and more different over the four stages. Figure 4b presents the distribution of the cells' G1 duration for the two states and that first the two states have all their phenotypes identical, and G1 duration in state 1 changes so they become distinct. In Figure 4c, the accuracy of state assignment is shown where for the case where the two states are the same, Wasserstein distance is approximately zero and as the two states become more distinct the Wasserstein distance gets larger, meaning they are more different. Intuitively, if the states are more distinct, determining single-cells' states is more accurate. As shown in Figure 4c, the model is capable of determining the true states of single-cells when they are almost similar by almost $80%$ accuracy and reaches above $90$ when they are further distinct.

![Accuracy of single-cell state assignment given similar or different states present in a population. (a) A cartoon depicting an evolution in one state in a population given the other state stays the same, to elaborate on the performance of the model in similar or different existing states in a population. (b) The distribution of a phenotype which is varied in state 1 (blue) and the other state is kept constant (sienna). (c) The accuracy of state assignment versus the Wasserstein distance between the two states. It shows the accuracy increases if the states are more distant from each other.](./output/figure5.svg){#fig:5}

### tHMM can pick up even rare phenotypes within the lineage.

[//]: # "Figure 6"

This parts explains how the model performs in the case of an under-represented population of cells.

![**State assignment accuracy when we have different proportions of each state, showing the model performs well even when there is an under- (or over-) represented population.](./output/figure6.svg){#fig:6}

### AIC metric indicates the model's capability to detemine the closest number of states in a population.

[//]: # "Figure 7"

The true number of states in a population is often unknown, and determining this value is rarely trivial. Estimating this value is important in this context, since the number of states in the population is a required parameter in our model. Akaike information criterion (AIC), a measure used for model selection, can help in determining this value. AIC provides an estimate for the information lost by modeling a process. With models of varying parameters that are built using the same input data, a lower AIC score indicates better model performance. Using AIC we can determine the number of states which best fit the data, serving as an estimate for the true number of states in the population. In order to demonstrate this we first generated 8 sets of 10 simulated lineages; censored and uncensored with 1, 2, 3, and 4 true states. We then built 7 models for each dataset varying the number assumed states (1 through 7). Each of the 8 graphs (Figure 7a-h) shows the model's performance on 1 of the datasets. The number of asssumed states yielding the smallest AIC represents the best prediction for the true number of states in the population. Finally, we reported the number of lineages which had the lowest AIC at each of the assumed states (1 through 7) in a histogram.This shows the number of states which best fit each individual lineage in the context of the model. Prediction in uncensored lineages (figure 7a-d) typically outperforms prediction in censored lineages (figure 7e-h), but this is dependent on the state distributions within the population. The smaller the number of states in the population the more accurate AIC will typically be. In Figure 7a and 7e with only 1 state, the number of states estimated perfectly matched with the true number of states in the population; however in figures 7d and 7h with 4 states, estimates become less definitive and less accurate. Though not perfectly accurate, AIC provides a reasonable estimate for the true number of states in the population.
Since AIC is a relative metric the values were normalized by subtracting the lowest AIC value for each lineage. Because of this the best estimate will always have a normalized AIC of 0. The simulated data was generated sampling from two Bernoulli distributions to deternmine the fate of the cell (life/death) in G1/G2 and a two Gamma distributions to determine the length of G1/G2. There were 4 unique states. State 1 had $bern_{G_1} = 0.99$, $bern_{G_2} = 0.9$, $shape_{G_1} = 10$, $scale_{G_1} = 2$, $shape_{G_2} = 10$, and $scale_{G_2} = 2$. State 2 had $bern_{G_1} = 0.9$, $bern_{G_2} = 0.9$, $shape_{G_1} = 20$, $scale_{G_1} = 3$, $shape_{G_2} = 20$, and $scale_{G_2} = 3$. State 3 had $bern_{G_1} = 0.85$, $bern_{G_2} = 0.9$, $shape_{G_1} = 30$, $scale_{G_1} = 4$, $shape_{G_2} = 30$, and $scale_{G_2} = 4$. State 4 had $bern_{G_1} = 0.8$, $bern_{G_2} = 0.9$, $shape_{G_1} = 40$, $scale_{G_1} = 5$, $shape_{G_2} = 40$, and $scale_{G_2} = 5$. In the censored data, lineages were filtered to have more than 10 cells and more than one unique state (if there was more than 1 state given).

![**AIC of the model varying the number of states predicted, showing that AIC can be used as a metric to aid in predicting the true number of states in the population.](./output/figure7.svg){#fig:7}
